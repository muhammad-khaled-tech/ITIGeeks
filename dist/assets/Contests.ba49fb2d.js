import{l as K,r as c,j as t,d as a,F as E}from"./vendor-react.06bced68.js";import{h as x,M as A,z as Q,N as X,P as Z,ah as ee,s as te,ai as re,a as G,V as b}from"./index.17f04fdd.js";import{l as M,_ as C,v as le,r as ae,a as P,y as se}from"./vendor-firebase.bbe5d1cc.js";import{P as ne}from"./ProblemSetBuilder.43f182f2.js";import"./vendor-ui.c6987468.js";const ge=()=>{const{isDark:s,adminUser:y}=K()||{isDark:!0,adminUser:null},[p,h]=c.exports.useState([]),[S,F]=c.exports.useState([]),[I,j]=c.exports.useState(!0),[g,f]=c.exports.useState(null),[m,v]=c.exports.useState(null),[N,O]=c.exports.useState("all"),[U,w]=c.exports.useState(!1),[l,i]=c.exports.useState({title:"",targetGroup:"All",startTime:"",endTime:"",problems:[""]});c.exports.useEffect(()=>{L()},[]);const L=async()=>{try{const[e,r]=await Promise.all([M(C(x,"contests")),M(C(x,"groups"))]);h(e.docs.map(n=>({id:n.id,...n.data()}))),F(r.docs.map(n=>({id:n.id,...n.data()})))}catch(e){console.error("Error fetching contests:",e)}finally{j(!1)}},T=e=>{const r=new Date,n=new Date(e.startTime),d=new Date(e.endTime);return r<n?"upcoming":r>=n&&r<=d?"active":"ended"},B=e=>{const r={upcoming:s?"bg-blue-900/50 text-blue-300":"bg-blue-100 text-blue-700",active:s?"bg-green-900/50 text-green-300":"bg-green-100 text-green-700",ended:s?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"},n={upcoming:"Upcoming",active:"Live",ended:"Ended"};return{style:r[e],label:n[e]}},z=e=>{if(e==="All")return"All Groups";const r=S.find(n=>n.id===e);return(r==null?void 0:r.name)||e},D=p.filter(e=>N==="all"||T(e)===N).sort((e,r)=>new Date(r.createdAt)-new Date(e.createdAt)),_=async()=>{if(!(!l.title.trim()||!l.startTime||!l.endTime))try{const e=await le(C(x,"contests"),{title:l.title.trim(),creatorId:(y==null?void 0:y.email)||"admin",targetGroup:l.targetGroup,problems:l.problems.map(r=>{var n,d;return typeof r=="string"?{slug:r.trim(),score:b.MEDIUM}:{slug:((n=r.slug)==null?void 0:n.trim())||((d=r.titleSlug)==null?void 0:d.trim()),score:r.score||b.MEDIUM}}).filter(r=>r.slug),startTime:new Date(l.startTime).toISOString(),endTime:new Date(l.endTime).toISOString(),status:"upcoming",createdAt:new Date().toISOString()});h([{id:e.id,...l,createdAt:new Date().toISOString()},...p]),u()}catch(e){console.error("Error creating contest:",e)}},H=async()=>{if(!(!l.title.trim()||!m))try{await ae(P(x,"contests",m.id),{title:l.title.trim(),targetGroup:l.targetGroup,problems:l.problems.map(e=>{var r,n;return typeof e=="string"?{slug:e.trim(),score:50}:{slug:((r=e.slug)==null?void 0:r.trim())||((n=e.titleSlug)==null?void 0:n.trim()),score:e.score||50}}).filter(e=>e.slug),startTime:new Date(l.startTime).toISOString(),endTime:new Date(l.endTime).toISOString()}),h(p.map(e=>e.id===m.id?{...e,...l}:e)),u()}catch(e){console.error("Error updating contest:",e)}},R=async()=>{if(!!m)try{await se(P(x,"contests",m.id)),h(p.filter(e=>e.id!==m.id)),u()}catch(e){console.error("Error deleting contest:",e)}},u=()=>{f(null),v(null),i({title:"",targetGroup:"All",startTime:"",endTime:"",problems:[""]})},q=e=>{var r;v(e),i({title:e.title,targetGroup:e.targetGroup||"All",startTime:e.startTime?new Date(e.startTime).toISOString().slice(0,16):"",endTime:e.endTime?new Date(e.endTime).toISOString().slice(0,16):"",problems:(r=e.problems)!=null&&r.length?e.problems:[""]}),f("edit")},V=()=>i({...l,problems:[...l.problems,""]}),W=e=>i({...l,problems:l.problems.filter((r,n)=>n!==e)}),Y=(e,r)=>{const n=[...l.problems];n[e]=r,i({...l,problems:n})};return I?t("div",{className:"flex items-center justify-center h-64",children:t("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-brand border-t-transparent"})}):a("div",{className:"space-y-6",children:[a("div",{className:"flex justify-between items-center",children:[a("div",{children:[t("h1",{className:`text-2xl font-bold ${s?"text-leet-text":"text-gray-900"}`,children:"Contests"}),a("p",{className:s?"text-leet-sub":"text-gray-500",children:[p.length," contests total"]})]}),a("button",{onClick:()=>{f("create"),i({title:"",targetGroup:"All",startTime:"",endTime:"",problems:[""]})},className:"flex items-center gap-2 px-4 py-2 bg-brand hover:bg-brand-hover text-white rounded-lg font-medium transition-colors",children:[t(A,{})," Create Contest"]})]}),t("div",{className:`rounded-lg p-4 flex gap-2 ${s?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:["all","active","upcoming","ended"].map(e=>t("button",{onClick:()=>O(e),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors capitalize ${N===e?"bg-brand text-white":s?"bg-leet-input text-leet-text hover:bg-leet-border":"bg-gray-100 hover:bg-gray-200"}`,children:e==="all"?"All":e},e))}),a("div",{className:"space-y-4",children:[D.map(e=>{var d;const r=T(e),n=B(r);return t("div",{className:`rounded-lg p-6 transition-shadow hover:shadow-lg ${s?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:a("div",{className:"flex justify-between items-start",children:[a("div",{className:"flex-1",children:[a("div",{className:"flex items-center gap-3 mb-2",children:[t(Q,{className:r==="active"?"text-yellow-500":s?"text-leet-sub":"text-gray-400"}),t("h3",{className:`text-lg font-bold ${s?"text-leet-text":"text-gray-900"}`,children:e.title}),t("span",{className:`px-2 py-1 rounded text-xs font-medium ${n.style}`,children:n.label})]}),a("div",{className:`flex flex-wrap gap-4 text-sm ${s?"text-leet-sub":"text-gray-500"}`,children:[a("span",{className:"flex items-center gap-1",children:[t(X,{})," ",z(e.targetGroup)]}),a("span",{className:"flex items-center gap-1",children:[t(Z,{})," ",new Date(e.startTime).toLocaleDateString()," - ",new Date(e.endTime).toLocaleDateString()]}),a("span",{children:[((d=e.problems)==null?void 0:d.length)||0," problems"]})]})]}),a("div",{className:"flex gap-2",children:[t("button",{onClick:()=>q(e),className:`p-2 rounded-lg transition-colors ${s?"hover:bg-leet-input text-leet-sub":"hover:bg-gray-100 text-gray-500"}`,title:"Edit",children:t(ee,{})}),t("button",{onClick:()=>{v(e),f("delete")},className:`p-2 rounded-lg transition-colors text-red-500 ${s?"hover:bg-leet-input":"hover:bg-gray-100"}`,title:"Delete",children:t(te,{})})]})]})},e.id)}),D.length===0&&t("div",{className:`text-center py-12 ${s?"text-leet-sub":"text-gray-500"}`,children:"No contests found. Create your first contest!"})]}),g&&t("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:u,children:a("div",{className:`rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto relative ${s?"bg-leet-card":"bg-white"}`,onClick:e=>e.stopPropagation(),children:[(g==="create"||g==="edit")&&a(E,{children:[t("h3",{className:`text-lg font-bold mb-6 ${s?"text-leet-text":"text-gray-900"}`,children:g==="create"?"Create New Contest":"Edit Contest"}),a("div",{className:"space-y-4",children:[a("div",{children:[t("label",{className:`block text-sm font-medium mb-1 ${s?"text-leet-sub":"text-gray-700"}`,children:"Contest Title *"}),t("input",{type:"text",value:l.title,onChange:e=>i({...l,title:e.target.value}),placeholder:"e.g., Weekly Contest #5",className:`w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/20 ${s?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`})]}),a("div",{children:[t("label",{className:`block text-sm font-medium mb-1 ${s?"text-leet-sub":"text-gray-700"}`,children:"Target Group"}),a("select",{value:l.targetGroup,onChange:e=>i({...l,targetGroup:e.target.value}),className:`w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/20 ${s?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`,children:[t("option",{value:"All",children:"All Groups"}),S.map(e=>t("option",{value:e.id,children:e.name},e.id))]})]}),a("div",{className:"grid grid-cols-2 gap-4",children:[a("div",{children:[t("label",{className:`block text-sm font-medium mb-1 ${s?"text-leet-sub":"text-gray-700"}`,children:"Start Time *"}),t("input",{type:"datetime-local",value:l.startTime,onChange:e=>i({...l,startTime:e.target.value}),className:`w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/20 ${s?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`})]}),a("div",{children:[t("label",{className:`block text-sm font-medium mb-1 ${s?"text-leet-sub":"text-gray-700"}`,children:"End Time *"}),t("input",{type:"datetime-local",value:l.endTime,onChange:e=>i({...l,endTime:e.target.value}),className:`w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/20 ${s?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`})]})]}),a("div",{children:[a("div",{className:"flex justify-between items-center mb-2",children:[a("label",{className:`block text-sm font-medium ${s?"text-leet-sub":"text-gray-700"}`,children:["Problems (",l.problems.filter(e=>{var r;return typeof e=="string"?e==null?void 0:e.trim():(r=e==null?void 0:e.slug)==null?void 0:r.trim()}).length," added)"]}),a("button",{type:"button",onClick:()=>w(!0),className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all",children:[t(re,{})," Smart Add"]})]}),t("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:l.problems.map((e,r)=>{const n=typeof e=="object"?e.slug:e;return a("div",{className:"flex gap-2",children:[t("input",{type:"text",value:n,onChange:d=>Y(r,d.target.value),placeholder:"LeetCode problem slug (e.g., two-sum)",className:`flex-1 px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/20 ${s?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`}),l.problems.length>1&&t("button",{onClick:()=>W(r),className:"p-2 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-lg",children:t(G,{})})]},r)})}),a("p",{className:`text-xs mt-1 ${s?"text-leet-sub":"text-gray-500"}`,children:["Points are auto-assigned: Easy=",b.EASY,", Medium=",b.MEDIUM,", Hard=",b.HARD]}),a("button",{onClick:V,className:"mt-2 text-sm flex items-center gap-1 text-brand hover:underline",children:[t(A,{})," Add Problem Manually"]})]})]}),a("div",{className:"flex gap-3 mt-6",children:[t("button",{onClick:u,className:`flex-1 px-4 py-2 rounded-lg ${s?"bg-leet-input hover:bg-leet-border text-leet-text":"bg-gray-100 hover:bg-gray-200"}`,children:"Cancel"}),t("button",{onClick:g==="create"?_:H,disabled:!l.title.trim()||!l.startTime||!l.endTime,className:"flex-1 px-4 py-2 rounded-lg bg-brand hover:bg-brand-hover text-white disabled:opacity-50",children:g==="create"?"Create Contest":"Save Changes"})]})]}),g==="delete"&&m&&a(E,{children:[t("h3",{className:`text-lg font-bold mb-4 ${s?"text-leet-text":"text-gray-900"}`,children:"Delete Contest?"}),a("p",{className:`mb-6 ${s?"text-leet-sub":"text-gray-600"}`,children:["Are you sure you want to delete ",t("strong",{children:m.title}),"? This action cannot be undone."]}),a("div",{className:"flex gap-3",children:[t("button",{onClick:u,className:`flex-1 px-4 py-2 rounded-lg ${s?"bg-leet-input hover:bg-leet-border text-leet-text":"bg-gray-100 hover:bg-gray-200"}`,children:"Cancel"}),t("button",{onClick:R,className:"flex-1 px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white",children:"Delete"})]})]}),t("button",{onClick:u,className:`absolute top-4 right-4 p-2 rounded-lg ${s?"hover:bg-leet-input text-leet-sub":"hover:bg-gray-100 text-gray-500"}`,children:t(G,{})})]})}),t(ne,{isOpen:U,onClose:()=>w(!1),onConfirm:e=>{const r=e.map(o=>({slug:o.titleSlug,score:o.score||b.MEDIUM})),n=l.problems.filter(o=>{var k;return(k=typeof o=="object"?o.slug:o)==null?void 0:k.trim()}),d=new Set(n.map(o=>typeof o=="object"?o.slug:o)),J=r.filter(o=>!d.has(o.slug)),$=[...n,...J];i({...l,problems:$.length>0?$:[{slug:"",score:b.MEDIUM}]}),w(!1)}})]})};export{ge as default};
