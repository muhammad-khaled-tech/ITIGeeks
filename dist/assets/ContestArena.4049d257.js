import{r as c,R as T,y as k,z as f,I as C,M as D,N as E,a as n,j as t,n as S,l as P,O as L,u as _,J as A,h as j,f as M,D as R,B as $,x as F,A as U,_ as z}from"./index.676580a2.js";import{B}from"./Badge.7390b850.js";const O=({contestId:i})=>{const[m,u]=c.exports.useState([]);c.exports.useEffect(()=>{if(!i)return;const s=T(k(f,"contests",i,"submissions"));return C(s,async x=>{const y=x.docs.map(e=>e.data()),d={},p=new Set;y.forEach(e=>{if(p.add(e.userId),d[e.userId]||(d[e.userId]={userId:e.userId,username:e.username,totalScore:0,problemsSolved:new Set,lastSubmissionTime:0}),!d[e.userId].problemsSolved.has(e.problemSlug)){d[e.userId].problemsSolved.add(e.problemSlug),d[e.userId].totalScore+=e.score;const r=new Date(e.timestamp).getTime();r>d[e.userId].lastSubmissionTime&&(d[e.userId].lastSubmissionTime=r)}});const N={};await Promise.all(Array.from(p).map(async e=>{const r=await D(E(f,"users",e));r.exists()&&(N[e]=r.data().badges||[])}));const l=Object.values(d).sort((e,r)=>r.totalScore!==e.totalScore?r.totalScore-e.totalScore:e.lastSubmissionTime-r.lastSubmissionTime).map(e=>({...e,badges:N[e.userId]||[]}));u(l)})},[i]);const o=s=>s===0?"bg-yellow-100 dark:bg-yellow-900/30 border-l-4 border-yellow-400":s===1?"bg-gray-100 dark:bg-gray-800/50 border-l-4 border-gray-400":s===2?"bg-orange-100 dark:bg-orange-900/30 border-l-4 border-orange-400":"hover:bg-gray-50 dark:hover:bg-leet-input border-l-4 border-transparent",w=s=>s===0?t(P,{className:"text-yellow-500 text-xl"}):s===1?t(S,{className:"text-gray-400 text-lg"}):s===2?t(S,{className:"text-orange-500 text-lg"}):n("span",{className:"font-mono font-bold text-gray-500 dark:text-gray-400",children:["#",s+1]});return n("div",{className:"bg-white dark:bg-leet-card rounded-lg shadow overflow-hidden",children:[t("div",{className:"bg-brand px-4 py-3 border-b border-brand-dark",children:n("h3",{className:"text-white font-bold flex items-center gap-2",children:[t(S,{})," Live Leaderboard"]})}),t("div",{className:"overflow-x-auto",children:n("table",{className:"min-w-full text-sm",children:[t("thead",{className:"bg-gray-50 dark:bg-leet-input",children:n("tr",{children:[t("th",{className:"px-4 py-2 text-left dark:text-gray-300 w-16",children:"Rank"}),t("th",{className:"px-4 py-2 text-left dark:text-gray-300",children:"User"}),t("th",{className:"px-4 py-2 text-right dark:text-gray-300",children:"Solved"}),t("th",{className:"px-4 py-2 text-right dark:text-gray-300",children:"Score"})]})}),n("tbody",{className:"divide-y divide-gray-200 dark:divide-leet-border",children:[m.map((s,g)=>n("tr",{className:`transition duration-150 ${o(g)}`,children:[t("td",{className:"px-4 py-3 flex items-center justify-center",children:w(g)}),t("td",{className:"px-4 py-3",children:n("div",{className:"flex items-center gap-2",children:[t("span",{className:"font-bold dark:text-white",children:s.username}),s.badges.length>0&&t("div",{className:"scale-75 origin-left",children:t(B,{name:s.badges[s.badges.length-1],size:"sm"})})]})}),t("td",{className:"px-4 py-3 text-right dark:text-gray-400 font-mono",children:s.problemsSolved.size}),t("td",{className:"px-4 py-3 text-right font-bold text-brand dark:text-brand-dark text-lg",children:s.totalScore})]},s.userId)),m.length===0&&t("tr",{children:t("td",{colSpan:"4",className:"text-center py-4 text-gray-500",children:"No submissions yet."})})]})]})})]})},J=()=>{const{contestId:i}=L(),{userData:m,currentUser:u}=_(),[o,w]=c.exports.useState(null),[s,g]=c.exports.useState(""),[x,y]=c.exports.useState(null),[d,p]=c.exports.useState(new Set);c.exports.useEffect(()=>{(async()=>{const l=E(f,"contests",i),e=await D(l);e.exists()&&w({id:e.id,...e.data()})})()},[i]),c.exports.useEffect(()=>{(async()=>{if(!u)return;const l=T(k(f,"contests",i,"submissions"),$("userId","==",u.uid)),e=await F(l),r=new Set(e.docs.map(b=>b.data().problemSlug));p(r)})()},[i,u]),c.exports.useEffect(()=>{if(!o)return;const a=setInterval(()=>{const l=new Date().getTime(),r=new Date(o.endTime).getTime()-l;if(r<0)g("ENDED"),clearInterval(a);else{const b=Math.floor(r%864e5/36e5),I=Math.floor(r%(1e3*60*60)/(1e3*60)),h=Math.floor(r%(1e3*60)/1e3);g(`${b}h ${I}m ${h}s`)}},1e3);return()=>clearInterval(a)},[o]);const N=async a=>{var l;if(!m.leetcodeUsername)return alert("Please set your LeetCode username in Profile first!");y(a.slug);try{const r=await(await fetch(`https://alfa-leetcode-api.onrender.com/user/${m.leetcodeUsername}/ac-submission-records`)).json(),b=new Date(o.startTime).getTime();if((l=r.submission)==null?void 0:l.find(h=>{const v=parseInt(h.timestamp)*1e3;return h.titleSlug===a.slug&&v>b})){await U(k(f,"contests",i,"submissions"),{userId:u.uid,username:m.leetcodeUsername,problemSlug:a.slug,score:a.score,timestamp:new Date().toISOString()}),p(v=>new Set(v).add(a.slug));const h=(await z(()=>import("./confetti.module.827099c3.js"),[])).default;h({particleCount:100,spread:70,origin:{y:.6}}),alert(`Correct! +${a.score} points`)}else alert("No valid submission found after contest start time. Make sure you solved it on LeetCode recently.")}catch(e){console.error(e),alert("Verification failed. API might be down.")}finally{y(null)}};return o?n("div",{className:"max-w-6xl mx-auto p-4 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[n("div",{className:"lg:col-span-2 space-y-6",children:[t("div",{className:"bg-white dark:bg-leet-card rounded-lg shadow p-6 border-l-4 border-brand",children:n("div",{className:"flex justify-between items-center",children:[t("h1",{className:"text-2xl font-bold dark:text-white",children:o.title}),n("div",{className:"text-xl font-mono font-bold bg-gray-100 dark:bg-leet-input px-4 py-2 rounded flex items-center gap-2 dark:text-white",children:[t(A,{className:s==="ENDED"?"text-red-500":"text-green-500"}),s]})]})}),t("div",{className:"bg-white dark:bg-leet-card rounded-lg shadow overflow-hidden",children:n("table",{className:"min-w-full",children:[t("thead",{className:"bg-gray-50 dark:bg-leet-input",children:n("tr",{children:[t("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Problem"}),t("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Points"}),t("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Action"})]})}),t("tbody",{className:"divide-y divide-gray-200 dark:divide-leet-border",children:o.problems.map((a,l)=>{const e=d.has(a.slug);return n("tr",{className:e?"bg-green-50 dark:bg-green-900/20":"",children:[t("td",{className:"px-6 py-4 whitespace-nowrap",children:n("a",{href:`https://leetcode.com/problems/${a.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-brand dark:text-brand-dark font-medium hover:underline flex items-center gap-1",children:[a.slug," ",t(j,{size:12})]})}),t("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold dark:text-white",children:a.score}),t("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e?n("span",{className:"text-green-600 font-bold flex items-center justify-end gap-1",children:[t(M,{})," Solved"]}):t("button",{onClick:()=>N(a),disabled:x===a.slug||s==="ENDED",className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm flex items-center gap-1 ml-auto disabled:opacity-50",children:x===a.slug?t(R,{className:"animate-spin"}):"Verify"})})]},l)})})]})})]}),t("div",{className:"lg:col-span-1",children:t(O,{contestId:o.id})})]}):t("div",{className:"p-6",children:"Loading Arena..."})};export{J as default};
