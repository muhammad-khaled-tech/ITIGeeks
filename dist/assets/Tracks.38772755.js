import{l as Q,r as c,j as t,d as s,F as G}from"./vendor-react.06bced68.js";import{h as g,M as V,l as W,J as X,a4 as Y,N as Z,ah as ee,s as te,a as re}from"./index.17f04fdd.js";import{l as S,_ as w,v as ae,r as C,a as f,y as se}from"./vendor-firebase.bbe5d1cc.js";import"./vendor-ui.c6987468.js";const ie=()=>{const{isDark:r}=Q()||{isDark:!0},[p,y]=c.exports.useState([]),[b,v]=c.exports.useState([]),[T,j]=c.exports.useState([]),[A,I]=c.exports.useState(!0),[u,N]=c.exports.useState(null),[d,$]=c.exports.useState(null),[P,L]=c.exports.useState({}),[l,h]=c.exports.useState({name:"",description:"",color:"#ef4444"}),[E,O]=c.exports.useState(""),R=["#ef4444","#f97316","#eab308","#22c55e","#06b6d4","#3b82f6","#8b5cf6","#ec4899","#6366f1","#14b8a6"];c.exports.useEffect(()=>{M()},[]);const M=async()=>{try{const[e,a,i]=await Promise.all([S(w(g,"tracks")),S(w(g,"groups")),S(w(g,"users"))]);y(e.docs.map(n=>({id:n.id,...n.data()}))),v(a.docs.map(n=>({id:n.id,...n.data()}))),j(i.docs.map(n=>({id:n.id,...n.data()})))}catch(e){console.error("Error fetching tracks:",e)}finally{I(!1)}},k=e=>b.filter(a=>a.trackId===e),z=e=>{const i=k(e).map(n=>n.id);return T.filter(n=>i.includes(n.groupId)).length},x=b.filter(e=>!e.trackId),U=async()=>{if(!!l.name.trim())try{const e=await ae(w(g,"tracks"),{name:l.name.trim(),description:l.description.trim(),color:l.color,createdAt:new Date().toISOString()});y([...p,{id:e.id,...l}]),m()}catch(e){console.error("Error creating track:",e)}},_=async()=>{if(!(!l.name.trim()||!d))try{await C(f(g,"tracks",d.id),{name:l.name.trim(),description:l.description.trim(),color:l.color}),y(p.map(e=>e.id===d.id?{...e,...l}:e)),m()}catch(e){console.error("Error updating track:",e)}},B=async()=>{if(!!d)try{const e=k(d.id);await Promise.all(e.map(a=>C(f(g,"groups",a.id),{trackId:null}))),await se(f(g,"tracks",d.id)),y(p.filter(a=>a.id!==d.id)),v(b.map(a=>a.trackId===d.id?{...a,trackId:null}:a)),m()}catch(e){console.error("Error deleting track:",e)}},F=async(e,a)=>{try{await C(f(g,"groups",e),{trackId:a}),v(b.map(i=>i.id===e?{...i,trackId:a}:i))}catch(i){console.error("Error assigning group:",i)}},J=async e=>{try{await C(f(g,"groups",e),{trackId:null}),v(b.map(a=>a.id===e?{...a,trackId:null}:a))}catch(a){console.error("Error removing group:",a)}},m=()=>{N(null),$(null),h({name:"",description:"",color:"#ef4444"})},q=e=>{L(a=>({...a,[e]:!a[e]}))},D=p.filter(e=>{var a;return(a=e.name)==null?void 0:a.toLowerCase().includes(E.toLowerCase())});return A?t("div",{className:"flex items-center justify-center h-64",children:t("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-brand border-t-transparent"})}):s("div",{className:"space-y-6",children:[s("div",{className:"flex justify-between items-center",children:[s("div",{children:[t("h1",{className:`text-2xl font-bold ${r?"text-leet-text":"text-gray-900"}`,children:"Tracks"}),t("p",{className:r?"text-leet-sub":"text-gray-500",children:"Organize groups by educational track"})]}),s("button",{onClick:()=>{N("create"),h({name:"",description:"",color:"#ef4444"})},className:"flex items-center gap-2 px-4 py-2 bg-brand hover:bg-brand-hover text-white rounded-lg font-medium transition-colors",children:[t(V,{})," Create Track"]})]}),t("div",{className:`rounded-lg p-4 ${r?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:t("input",{type:"text",placeholder:"Search tracks...",value:E,onChange:e=>O(e.target.value),className:`w-full max-w-md px-4 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand/20 ${r?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`})}),s("div",{className:"space-y-4",children:[D.map(e=>{const a=k(e.id),i=z(e.id),n=P[e.id];return s("div",{className:`rounded-lg overflow-hidden ${r?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:[s("div",{className:`p-4 flex items-center justify-between cursor-pointer ${r?"hover:bg-leet-input/50":"hover:bg-gray-50"}`,onClick:()=>q(e.id),children:[s("div",{className:"flex items-center gap-3",children:[n?t(W,{className:r?"text-leet-sub":"text-gray-400"}):t(X,{className:r?"text-leet-sub":"text-gray-400"}),t("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:e.color||"#3b82f6"}}),s("div",{children:[t("h3",{className:`font-bold ${r?"text-leet-text":"text-gray-900"}`,children:e.name}),e.description&&t("p",{className:`text-sm ${r?"text-leet-sub":"text-gray-500"}`,children:e.description})]})]}),s("div",{className:"flex items-center gap-4",children:[s("div",{className:`flex items-center gap-4 text-sm ${r?"text-leet-sub":"text-gray-500"}`,children:[s("span",{className:"flex items-center gap-1",children:[t(Y,{})," ",a.length," groups"]}),s("span",{className:"flex items-center gap-1",children:[t(Z,{})," ",i," students"]})]}),s("div",{className:"flex gap-1",onClick:o=>o.stopPropagation(),children:[t("button",{onClick:()=>{$(e),h({name:e.name,description:e.description||"",color:e.color||"#ef4444"}),N("edit")},className:`p-2 rounded-lg transition-colors ${r?"hover:bg-leet-input text-leet-sub":"hover:bg-gray-100 text-gray-500"}`,children:t(ee,{})}),t("button",{onClick:()=>{$(e),N("delete")},className:`p-2 rounded-lg transition-colors text-red-500 ${r?"hover:bg-leet-input":"hover:bg-gray-100"}`,children:t(te,{})})]})]})]}),n&&s("div",{className:`border-t p-4 ${r?"border-leet-border bg-leet-input/30":"border-gray-200 bg-gray-50"}`,children:[a.length>0?t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:a.map(o=>{const H=T.filter(K=>K.groupId===o.id).length;return s("div",{className:`p-3 rounded-lg flex items-center justify-between ${r?"bg-leet-card":"bg-white"}`,children:[s("div",{children:[t("p",{className:`font-medium ${r?"text-leet-text":"text-gray-900"}`,children:o.name}),s("p",{className:`text-xs ${r?"text-leet-sub":"text-gray-500"}`,children:[H," students"]})]}),t("button",{onClick:()=>J(o.id),className:"text-red-500 hover:text-red-600 text-xs",children:"Remove"})]},o.id)})}):t("p",{className:`text-sm ${r?"text-leet-sub":"text-gray-500"}`,children:"No groups assigned to this track yet."}),x.length>0&&t("div",{className:"mt-3",children:s("select",{onChange:o=>{o.target.value&&F(o.target.value,e.id),o.target.value=""},className:`px-3 py-2 rounded-lg text-sm focus:outline-none ${r?"bg-leet-input text-leet-text border border-leet-border":"bg-white border"}`,children:[t("option",{value:"",children:"+ Add group to track..."}),x.map(o=>t("option",{value:o.id,children:o.name},o.id))]})})]})]},e.id)}),D.length===0&&t("div",{className:`text-center py-12 ${r?"text-leet-sub":"text-gray-500"}`,children:"No tracks found. Create your first track!"})]}),x.length>0&&s("div",{className:`rounded-lg p-6 ${r?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:[s("h3",{className:`font-bold mb-4 ${r?"text-leet-text":"text-gray-900"}`,children:["Unassigned Groups (",x.length,")"]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:x.map(e=>s("div",{className:`p-3 rounded-lg flex items-center justify-between ${r?"bg-leet-input":"bg-gray-50"}`,children:[t("span",{className:r?"text-leet-text":"text-gray-900",children:e.name}),p.length>0&&s("select",{onChange:a=>{a.target.value&&F(e.id,a.target.value)},className:`px-2 py-1 rounded text-xs focus:outline-none ${r?"bg-leet-card text-leet-text border border-leet-border":"bg-white border"}`,children:[t("option",{value:"",children:"Assign to..."}),p.map(a=>t("option",{value:a.id,children:a.name},a.id))]})]},e.id))})]}),u&&t("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:m,children:s("div",{className:`rounded-lg p-6 w-full max-w-md relative ${r?"bg-leet-card":"bg-white"}`,onClick:e=>e.stopPropagation(),children:[(u==="create"||u==="edit")&&s(G,{children:[t("h3",{className:`text-lg font-bold mb-6 ${r?"text-leet-text":"text-gray-900"}`,children:u==="create"?"Create New Track":"Edit Track"}),s("div",{className:"space-y-4",children:[s("div",{children:[t("label",{className:`block text-sm font-medium mb-1 ${r?"text-leet-sub":"text-gray-700"}`,children:"Track Name *"}),t("input",{type:"text",value:l.name,onChange:e=>h({...l,name:e.target.value}),placeholder:"e.g., Open Source Applications",className:`w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/20 ${r?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`})]}),s("div",{children:[t("label",{className:`block text-sm font-medium mb-1 ${r?"text-leet-sub":"text-gray-700"}`,children:"Description"}),t("textarea",{value:l.description,onChange:e=>h({...l,description:e.target.value}),placeholder:"Brief description...",rows:2,className:`w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/20 ${r?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`})]}),s("div",{children:[t("label",{className:`block text-sm font-medium mb-2 ${r?"text-leet-sub":"text-gray-700"}`,children:"Color"}),t("div",{className:"flex gap-2 flex-wrap",children:R.map(e=>t("button",{onClick:()=>h({...l,color:e}),className:`w-8 h-8 rounded-full transition-transform ${l.color===e?"scale-110 ring-2 ring-white ring-offset-2 ring-offset-gray-900":""}`,style:{backgroundColor:e}},e))})]})]}),s("div",{className:"flex gap-3 mt-6",children:[t("button",{onClick:m,className:`flex-1 px-4 py-2 rounded-lg ${r?"bg-leet-input hover:bg-leet-border text-leet-text":"bg-gray-100 hover:bg-gray-200"}`,children:"Cancel"}),t("button",{onClick:u==="create"?U:_,disabled:!l.name.trim(),className:"flex-1 px-4 py-2 rounded-lg bg-brand hover:bg-brand-hover text-white disabled:opacity-50",children:u==="create"?"Create":"Save"})]})]}),u==="delete"&&d&&s(G,{children:[t("h3",{className:`text-lg font-bold mb-4 ${r?"text-leet-text":"text-gray-900"}`,children:"Delete Track?"}),s("p",{className:`mb-2 ${r?"text-leet-sub":"text-gray-600"}`,children:["Are you sure you want to delete ",t("strong",{children:d.name}),"?"]}),s("p",{className:`text-sm mb-6 ${r?"text-yellow-400":"text-yellow-600"}`,children:["\u26A0\uFE0F ",k(d.id).length," groups will be unassigned from this track."]}),s("div",{className:"flex gap-3",children:[t("button",{onClick:m,className:`flex-1 px-4 py-2 rounded-lg ${r?"bg-leet-input hover:bg-leet-border text-leet-text":"bg-gray-100 hover:bg-gray-200"}`,children:"Cancel"}),t("button",{onClick:B,className:"flex-1 px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white",children:"Delete"})]})]}),t("button",{onClick:m,className:`absolute top-4 right-4 p-2 rounded-lg ${r?"hover:bg-leet-input text-leet-sub":"hover:bg-gray-100 text-gray-500"}`,children:t(re,{})})]})})]})};export{ie as default};
