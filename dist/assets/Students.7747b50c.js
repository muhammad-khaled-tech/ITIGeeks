import{l as V,r as i,j as t,d as l,F as v}from"./vendor-react.06bced68.js";import{h as u,T as q,ad as H,ae as J,af as K,aa as Q,ag as W,s as X,ab as G,a as Y}from"./index.17f04fdd.js";import{l as R,_ as A,r as S,a as N,y as Z}from"./vendor-firebase.bbe5d1cc.js";import"./vendor-ui.c6987468.js";const ae=()=>{const{isDark:r}=V()||{isDark:!0},[g,p]=i.exports.useState([]),[b,U]=i.exports.useState([]),[j,D]=i.exports.useState(!0),[w,E]=i.exports.useState(""),[y,I]=i.exports.useState("all"),[$,T]=i.exports.useState("all"),[s,c]=i.exports.useState(null),[k,x]=i.exports.useState(null),[h,n]=i.exports.useState(null);i.exports.useState([]),i.exports.useEffect(()=>{L()},[]);const L=async()=>{try{const[e,a]=await Promise.all([R(A(u,"users")),R(A(u,"groups"))]),o=e.docs.map(d=>{const m=d.data(),f=(m.problems||[]).filter(O=>O.status==="Done").length;return{id:d.id,...m,solved:f}});p(o),U(a.docs.map(d=>({id:d.id,...d.data()})))}catch(e){console.error("Error fetching students:",e)}finally{D(!1)}},C=g.filter(e=>{var m,f;const a=(((m=e.email)==null?void 0:m.toLowerCase())||"").includes(w.toLowerCase())||(((f=e.leetcodeUsername)==null?void 0:f.toLowerCase())||"").includes(w.toLowerCase()),o=y==="all"||e.groupId===y||!e.groupId&&y==="none",d=$==="all"||e.role===$;return a&&o&&d}),M=async(e,a)=>{try{await S(N(u,"users",e),{role:a}),p(g.map(o=>o.id===e?{...o,role:a}:o)),n(null),c(null)}catch(o){console.error("Error updating role:",o)}},z=async(e,a)=>{try{await S(N(u,"users",e),{groupId:a}),p(g.map(o=>o.id===e?{...o,groupId:a}:o)),n(null),c(null)}catch(o){console.error("Error assigning group:",o)}},_=async e=>{try{await S(N(u,"users",e),{groupId:null}),p(g.map(a=>a.id===e?{...a,groupId:null}:a)),n(null),c(null)}catch(a){console.error("Error removing from group:",a)}},P=async e=>{if(!!s)try{await Z(N(u,"users",s.id)),p(g.filter(a=>a.id!==s.id)),n(null),c(null)}catch(a){console.error("Error deleting student:",a)}},F=e=>{if(!e)return"No Group";const a=b.find(o=>o.id===e);return(a==null?void 0:a.name)||e},B=e=>{const a={student:r?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700",instructor:r?"bg-blue-900/50 text-blue-300":"bg-blue-100 text-blue-700",supervisor:r?"bg-purple-900/50 text-purple-300":"bg-purple-100 text-purple-700"};return a[e]||a.student};return j?t("div",{className:"flex items-center justify-center h-64",children:t("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-brand border-t-transparent"})}):l("div",{className:"space-y-6",children:[t("div",{className:"flex justify-between items-center",children:l("div",{children:[t("h1",{className:`text-2xl font-bold ${r?"text-leet-text":"text-gray-900"}`,children:"Students"}),l("p",{className:r?"text-leet-sub":"text-gray-500",children:[C.length," students found"]})]})}),l("div",{className:`rounded-lg p-4 flex flex-wrap gap-4 ${r?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:[l("div",{className:"relative flex-1 min-w-[200px]",children:[t(q,{className:`absolute left-3 top-1/2 -translate-y-1/2 ${r?"text-leet-sub":"text-gray-400"}`}),t("input",{type:"text",placeholder:"Search by email or username...",value:w,onChange:e=>E(e.target.value),className:`w-full pl-10 pr-4 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand/20 ${r?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`})]}),l("div",{className:"flex items-center gap-2",children:[t(H,{className:r?"text-leet-sub":"text-gray-400"}),l("select",{value:y,onChange:e=>I(e.target.value),className:`px-3 py-2 rounded-lg text-sm focus:outline-none ${r?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`,children:[t("option",{value:"all",children:"All Groups"}),t("option",{value:"none",children:"No Group"}),b.map(e=>t("option",{value:e.id,children:e.name},e.id))]})]}),l("select",{value:$,onChange:e=>T(e.target.value),className:`px-3 py-2 rounded-lg text-sm focus:outline-none ${r?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`,children:[t("option",{value:"all",children:"All Roles"}),t("option",{value:"student",children:"Students"}),t("option",{value:"instructor",children:"Instructors"}),t("option",{value:"supervisor",children:"Supervisors"})]})]}),l("div",{className:`rounded-lg ${r?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:[l("table",{className:"w-full",children:[t("thead",{className:r?"bg-leet-input":"bg-gray-50",children:l("tr",{children:[t("th",{className:`px-6 py-3 text-left text-xs font-medium uppercase tracking-wider ${r?"text-leet-sub":"text-gray-500"}`,children:"User"}),t("th",{className:`px-6 py-3 text-left text-xs font-medium uppercase tracking-wider ${r?"text-leet-sub":"text-gray-500"}`,children:"Group"}),t("th",{className:`px-6 py-3 text-left text-xs font-medium uppercase tracking-wider ${r?"text-leet-sub":"text-gray-500"}`,children:"Role"}),t("th",{className:`px-6 py-3 text-left text-xs font-medium uppercase tracking-wider ${r?"text-leet-sub":"text-gray-500"}`,children:"Solved"}),t("th",{className:`px-6 py-3 text-right text-xs font-medium uppercase tracking-wider ${r?"text-leet-sub":"text-gray-500"}`,children:"Actions"})]})}),t("tbody",{className:`divide-y ${r?"divide-leet-border":"divide-gray-200"}`,children:C.map(e=>l("tr",{className:r?"hover:bg-leet-input/50":"hover:bg-gray-50",children:[t("td",{className:"px-6 py-4 whitespace-nowrap",children:l("div",{className:"flex items-center gap-3",children:[t("div",{className:"w-10 h-10 rounded-full bg-brand/20 flex items-center justify-center text-brand font-bold",children:(e.displayName||e.email||"U")[0].toUpperCase()}),l("div",{children:[t("p",{className:`font-medium ${r?"text-leet-text":"text-gray-900"}`,children:e.displayName||e.leetcodeUsername||"No username"}),t("p",{className:`text-sm ${r?"text-leet-sub":"text-gray-500"}`,children:e.email})]})]})}),t("td",{className:"px-6 py-4 whitespace-nowrap",children:t("span",{className:`px-2 py-1 rounded text-xs font-medium ${e.groupId?r?"bg-green-900/30 text-green-400":"bg-green-100 text-green-700":r?"bg-gray-700 text-gray-400":"bg-gray-100 text-gray-500"}`,children:F(e.groupId)})}),t("td",{className:"px-6 py-4 whitespace-nowrap",children:t("span",{className:`px-2 py-1 rounded text-xs font-medium capitalize ${B(e.role)}`,children:e.role||"student"})}),t("td",{className:"px-6 py-4 whitespace-nowrap",children:t("span",{className:`font-bold ${r?"text-leet-text":"text-gray-900"}`,children:e.solved})}),l("td",{className:"px-6 py-4 whitespace-nowrap text-right relative",children:[t("button",{onClick:()=>x(k===e.id?null:e.id),className:`p-2 rounded-lg transition-colors ${r?"hover:bg-leet-input text-leet-sub":"hover:bg-gray-100 text-gray-500"}`,children:t(J,{})}),k===e.id&&l("div",{className:`absolute right-0 mt-2 w-48 rounded-lg shadow-lg z-50 border ${r?"bg-leet-card border-leet-border":"bg-white border-gray-200"}`,children:[l("button",{onClick:()=>{c(e),n("role"),x(null)},className:`w-full flex items-center gap-2 px-4 py-2 text-sm text-left ${r?"hover:bg-leet-input text-leet-text":"hover:bg-gray-50"}`,children:[t(K,{})," Change Role"]}),l("button",{onClick:()=>{c(e),n("group"),x(null)},className:`w-full flex items-center gap-2 px-4 py-2 text-sm text-left ${r?"hover:bg-leet-input text-leet-text":"hover:bg-gray-50"}`,children:[t(Q,{})," Assign to Group"]}),e.groupId&&l("button",{onClick:()=>{c(e),n("remove"),x(null)},className:`w-full flex items-center gap-2 px-4 py-2 text-sm text-left text-red-500 ${r?"hover:bg-leet-input":"hover:bg-gray-50"}`,children:[t(W,{})," Remove from Group"]}),t("div",{className:`h-px my-1 ${r?"bg-leet-border":"bg-gray-200"}`}),l("button",{onClick:()=>{c(e),n("delete_student"),x(null)},className:`w-full flex items-center gap-2 px-4 py-2 text-sm text-left text-red-500 ${r?"hover:bg-leet-input":"hover:bg-gray-50"}`,children:[t(X,{})," Delete User"]})]})]})]},e.id))})]}),C.length===0&&t("div",{className:`text-center py-12 ${r?"text-leet-sub":"text-gray-500"}`,children:"No students found matching your filters."})]}),h&&s&&t("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>n(null),children:l("div",{className:`rounded-lg p-6 w-full max-w-md ${r?"bg-leet-card":"bg-white"}`,onClick:e=>e.stopPropagation(),children:[h==="role"&&l(v,{children:[l("h3",{className:`text-lg font-bold mb-4 ${r?"text-leet-text":"text-gray-900"}`,children:["Change Role for ",s.email]}),t("div",{className:"space-y-2",children:["student","instructor","supervisor"].map(e=>l("button",{onClick:()=>M(s.id,e),className:`w-full px-4 py-3 rounded-lg text-left capitalize flex items-center justify-between ${s.role===e?"bg-brand text-white":r?"bg-leet-input hover:bg-leet-border text-leet-text":"bg-gray-100 hover:bg-gray-200"}`,children:[e,s.role===e&&t(G,{})]},e))})]}),h==="group"&&l(v,{children:[l("h3",{className:`text-lg font-bold mb-4 ${r?"text-leet-text":"text-gray-900"}`,children:["Assign ",s.email," to Group"]}),l("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[b.map(e=>l("button",{onClick:()=>z(s.id,e.id),className:`w-full px-4 py-3 rounded-lg text-left flex items-center justify-between ${s.groupId===e.id?"bg-brand text-white":r?"bg-leet-input hover:bg-leet-border text-leet-text":"bg-gray-100 hover:bg-gray-200"}`,children:[e.name,s.groupId===e.id&&t(G,{})]},e.id)),b.length===0&&t("p",{className:r?"text-leet-sub":"text-gray-500",children:"No groups available. Create groups first."})]})]}),h==="remove"&&l(v,{children:[t("h3",{className:`text-lg font-bold mb-4 ${r?"text-leet-text":"text-gray-900"}`,children:"Remove from Group?"}),l("p",{className:`mb-6 ${r?"text-leet-sub":"text-gray-600"}`,children:["Are you sure you want to remove ",t("strong",{children:s.email})," from ",t("strong",{children:F(s.groupId)}),"?"]}),l("div",{className:"flex gap-3",children:[t("button",{onClick:()=>n(null),className:`flex-1 px-4 py-2 rounded-lg ${r?"bg-leet-input hover:bg-leet-border text-leet-text":"bg-gray-100 hover:bg-gray-200"}`,children:"Cancel"}),t("button",{onClick:()=>_(s.id),className:"flex-1 px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white",children:"Remove"})]})]}),h==="delete_student"&&l(v,{children:[t("h3",{className:`text-lg font-bold mb-4 ${r?"text-leet-text":"text-gray-900"}`,children:"Delete User?"}),l("p",{className:`mb-2 ${r?"text-leet-sub":"text-gray-600"}`,children:["Are you sure you want to delete ",t("strong",{children:s.email}),"?"]}),t("p",{className:`text-sm mb-6 ${r?"text-yellow-400":"text-yellow-600"}`,children:"\u26A0\uFE0F This action cannot be undone."}),l("div",{className:"flex gap-3",children:[t("button",{onClick:()=>n(null),className:`flex-1 px-4 py-2 rounded-lg ${r?"bg-leet-input hover:bg-leet-border text-leet-text":"bg-gray-100 hover:bg-gray-200"}`,children:"Cancel"}),t("button",{onClick:()=>P(s.id),className:"flex-1 px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white",children:"Delete"})]})]}),t("button",{onClick:()=>n(null),className:`absolute top-4 right-4 p-2 rounded-lg ${r?"hover:bg-leet-input text-leet-sub":"hover:bg-gray-100 text-gray-500"}`,children:t(Y,{})})]})})]})};export{ae as default};
