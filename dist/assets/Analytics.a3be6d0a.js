import{l as Q,r as u,j as e,d as s}from"./vendor-react.06bced68.js";import{h,N as R,d as V,z as D,A as W,E as X,B as Y}from"./index.17f04fdd.js";import{l as p,_ as x}from"./vendor-firebase.bbe5d1cc.js";import"./vendor-ui.c6987468.js";const ae=()=>{const{isDark:t}=Q()||{isDark:!0},[b,y]=u.exports.useState(null),[v,F]=u.exports.useState(!0),[N,H]=u.exports.useState("all");u.exports.useState("all"),u.exports.useEffect(()=>{U()},[]);const U=async()=>{try{const[l,d,n,i]=await Promise.all([p(x(h,"users")),p(x(h,"groups")),p(x(h,"contests")),p(x(h,"assignments"))]),o=l.docs.map(a=>({id:a.id,...a.data()})),M=d.docs.map(a=>({id:a.id,...a.data()})),B=n.docs.map(a=>({id:a.id,...a.data()})),L=i.docs.map(a=>({id:a.id,...a.data()})),_=o.reduce((a,r)=>{var g;return a+(((g=r.problems)==null?void 0:g.length)||0)},0),k=o.reduce((a,r)=>{var g;return a+(((g=r.problems)==null?void 0:g.filter(m=>m.status==="Done").length)||0)},0),z=M.map(a=>{const r=o.filter(m=>m.groupId===a.id),g=r.reduce((m,J)=>{var C;return m+(((C=J.problems)==null?void 0:C.filter(K=>K.status==="Done").length)||0)},0);return{...a,studentCount:r.length,totalSolved:g,avgSolved:r.length?Math.round(g/r.length):0}}).sort((a,r)=>r.avgSolved-a.avgSolved),$={Easy:0,Medium:0,Hard:0};o.forEach(a=>{(a.problems||[]).filter(r=>r.status==="Done").forEach(r=>{r.difficulty&&($[r.difficulty]=($[r.difficulty]||0)+1)})});const O=o.map(a=>({...a,solved:(a.problems||[]).filter(r=>r.status==="Done").length})).sort((a,r)=>r.solved-a.solved).slice(0,10),q=o.map(a=>({...a,attempted:(a.problems||[]).length})).sort((a,r)=>r.attempted-a.attempted).slice(0,5);y({users:o,groups:M,contests:B,assignments:L,totalProblems:_,solvedProblems:k,groupStats:z,difficultyStats:$,topPerformers:O,mostActive:q})}catch(l){console.error("Error fetching analytics:",l)}finally{F(!1)}};if(v)return e("div",{className:"flex items-center justify-center h-64",children:e("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-brand border-t-transparent"})});if(!b)return null;const{users:S,groups:j,contests:G,assignments:T,solvedProblems:Z,groupStats:w,difficultyStats:c,topPerformers:A,mostActive:P}=b,E=N==="all"?S:S.filter(l=>l.groupId===N),I=E.reduce((l,d)=>{var n;return l+(((n=d.problems)==null?void 0:n.filter(i=>i.status==="Done").length)||0)},0);return s("div",{className:"space-y-6",children:[s("div",{className:"flex justify-between items-center",children:[s("div",{children:[e("h1",{className:`text-2xl font-bold ${t?"text-leet-text":"text-gray-900"}`,children:"Analytics"}),e("p",{className:t?"text-leet-sub":"text-gray-500",children:"Performance insights and reports"})]}),e("div",{className:"flex gap-3",children:s("select",{value:N,onChange:l=>H(l.target.value),className:`px-3 py-2 rounded-lg text-sm focus:outline-none ${t?"bg-leet-input text-leet-text border border-leet-border":"bg-white border"}`,children:[e("option",{value:"all",children:"All Groups"}),j.map(l=>e("option",{value:l.id,children:l.name},l.id))]})})]}),s("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e(f,{isDark:t,icon:e(R,{className:"text-blue-500"}),label:"Total Students",value:E.length}),e(f,{isDark:t,icon:e(V,{className:"text-green-500"}),label:"Problems Solved",value:I}),e(f,{isDark:t,icon:e(D,{className:"text-yellow-500"}),label:"Contests",value:G.length}),e(f,{isDark:t,icon:e(W,{className:"text-purple-500"}),label:"Assignments",value:T.length})]}),s("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s("div",{className:`lg:col-span-2 rounded-lg p-6 ${t?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:[s("h3",{className:`text-lg font-bold mb-4 flex items-center gap-2 ${t?"text-leet-text":"text-gray-900"}`,children:[e(X,{className:"text-yellow-500"})," Group Performance"]}),w.length>0?e("div",{className:"space-y-3",children:w.map((l,d)=>{const n=Math.max(...w.map(o=>o.avgSolved),1),i=l.avgSolved/n*100;return s("div",{className:"space-y-1",children:[s("div",{className:"flex justify-between items-center",children:[s("div",{className:"flex items-center gap-2",children:[e("span",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${d===0?"bg-yellow-100 text-yellow-700":d===1?"bg-gray-100 text-gray-700":d===2?"bg-orange-100 text-orange-700":t?"bg-leet-input text-leet-sub":"bg-gray-100 text-gray-500"}`,children:d+1}),e("span",{className:t?"text-leet-text":"text-gray-900",children:l.name}),s("span",{className:`text-xs ${t?"text-leet-sub":"text-gray-500"}`,children:["(",l.studentCount," students)"]})]}),s("span",{className:`font-bold ${t?"text-leet-text":"text-gray-900"}`,children:[l.avgSolved," avg"]})]}),e("div",{className:`h-2 rounded-full overflow-hidden ${t?"bg-leet-input":"bg-gray-200"}`,children:e("div",{className:"h-full bg-gradient-to-r from-brand to-green-500 rounded-full transition-all duration-500",style:{width:`${i}%`}})})]},l.id)})}):e("p",{className:t?"text-leet-sub":"text-gray-500",children:"No groups created yet."})]}),s("div",{className:`rounded-lg p-6 ${t?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:[e("h3",{className:`text-lg font-bold mb-4 ${t?"text-leet-text":"text-gray-900"}`,children:"Difficulty Breakdown"}),e("div",{className:"space-y-4",children:[{label:"Easy",color:"bg-green-500",value:c.Easy||0},{label:"Medium",color:"bg-yellow-500",value:c.Medium||0},{label:"Hard",color:"bg-red-500",value:c.Hard||0}].map(l=>{const d=(c.Easy||0)+(c.Medium||0)+(c.Hard||0),n=d?Math.round(l.value/d*100):0;return s("div",{children:[s("div",{className:"flex justify-between mb-1",children:[e("span",{className:t?"text-leet-text":"text-gray-700",children:l.label}),s("span",{className:t?"text-leet-sub":"text-gray-500",children:[l.value," (",n,"%)"]})]}),e("div",{className:`h-3 rounded-full overflow-hidden ${t?"bg-leet-input":"bg-gray-200"}`,children:e("div",{className:`h-full ${l.color} rounded-full transition-all duration-500`,style:{width:`${n}%`}})})]},l.label)})}),e("div",{className:`mt-6 pt-4 border-t ${t?"border-leet-border":"border-gray-200"}`,children:s("div",{className:"flex justify-between",children:[e("span",{className:t?"text-leet-sub":"text-gray-500",children:"Total Solved"}),e("span",{className:`font-bold ${t?"text-leet-text":"text-gray-900"}`,children:(c.Easy||0)+(c.Medium||0)+(c.Hard||0)})]})})]})]}),s("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s("div",{className:`rounded-lg p-6 ${t?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:[s("h3",{className:`text-lg font-bold mb-4 flex items-center gap-2 ${t?"text-leet-text":"text-gray-900"}`,children:[e(D,{className:"text-yellow-500"})," Top 10 Performers"]}),s("div",{className:"space-y-2",children:[A.map((l,d)=>{var n,i;return s("div",{className:`flex items-center justify-between p-3 rounded-lg ${t?"bg-leet-input":"bg-gray-50"}`,children:[s("div",{className:"flex items-center gap-3",children:[e("span",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${d===0?"bg-yellow-400 text-yellow-900":d===1?"bg-gray-300 text-gray-700":d===2?"bg-orange-400 text-orange-900":t?"bg-leet-border text-leet-sub":"bg-gray-200 text-gray-600"}`,children:d+1}),s("div",{children:[e("p",{className:`font-medium ${t?"text-leet-text":"text-gray-900"}`,children:l.leetcodeUsername||((n=l.email)==null?void 0:n.split("@")[0])||"Anonymous"}),e("p",{className:`text-xs ${t?"text-leet-sub":"text-gray-500"}`,children:((i=j.find(o=>o.id===l.groupId))==null?void 0:i.name)||"No group"})]})]}),e("span",{className:"font-bold text-brand",children:l.solved})]},l.id)}),A.length===0&&e("p",{className:t?"text-leet-sub":"text-gray-500",children:"No data yet."})]})]}),s("div",{className:`rounded-lg p-6 ${t?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:[s("h3",{className:`text-lg font-bold mb-4 flex items-center gap-2 ${t?"text-leet-text":"text-gray-900"}`,children:[e(Y,{className:"text-orange-500"})," Most Active Students"]}),s("div",{className:"space-y-2",children:[P.map((l,d)=>{var n;return s("div",{className:`flex items-center justify-between p-3 rounded-lg ${t?"bg-leet-input":"bg-gray-50"}`,children:[s("div",{className:"flex items-center gap-3",children:[e("span",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${d===0?"bg-orange-400 text-orange-900":t?"bg-leet-border text-leet-sub":"bg-gray-200 text-gray-600"}`,children:d+1}),e("div",{children:e("p",{className:`font-medium ${t?"text-leet-text":"text-gray-900"}`,children:l.leetcodeUsername||((n=l.email)==null?void 0:n.split("@")[0])||"Anonymous"})})]}),s("span",{className:`font-medium ${t?"text-leet-sub":"text-gray-600"}`,children:[l.attempted," problems"]})]},l.id)}),P.length===0&&e("p",{className:t?"text-leet-sub":"text-gray-500",children:"No data yet."})]})]})]})]})},f=({isDark:t,icon:b,label:y,value:v})=>e("div",{className:`rounded-lg p-4 ${t?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:s("div",{className:"flex items-center gap-3",children:[e("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${t?"bg-leet-input":"bg-gray-100"}`,children:b}),s("div",{children:[e("p",{className:`text-2xl font-bold ${t?"text-leet-text":"text-gray-900"}`,children:v}),e("p",{className:`text-sm ${t?"text-leet-sub":"text-gray-500"}`,children:y})]})]})});export{ae as default};
