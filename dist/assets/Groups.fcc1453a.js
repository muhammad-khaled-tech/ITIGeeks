import{l as P,r as i,j as t,d as a,F as S}from"./vendor-react.06bced68.js";import{h as m,M as L,T as M,ah as O,s as U,N as _,a as z}from"./index.17f04fdd.js";import{l as k,_ as y,v as B,r as G,a as v,y as R}from"./vendor-firebase.bbe5d1cc.js";import"./vendor-ui.c6987468.js";const Q=()=>{const{isDark:r}=P()||{isDark:!0},[p,g]=i.exports.useState([]),[b,N]=i.exports.useState([]),[D,F]=i.exports.useState(!0),[d,o]=i.exports.useState(null),[n,h]=i.exports.useState(null),[s,u]=i.exports.useState({name:"",description:""}),[x,E]=i.exports.useState("");i.exports.useEffect(()=>{j()},[]);const j=async()=>{try{const[e,l]=await Promise.all([k(y(m,"groups")),k(y(m,"users"))]);g(e.docs.map(c=>({id:c.id,...c.data()}))),N(l.docs.map(c=>({id:c.id,...c.data()})))}catch(e){console.error("Error fetching groups:",e)}finally{F(!1)}},w=e=>b.filter(l=>l.groupId===e).length,C=e=>b.filter(l=>l.groupId===e),I=async()=>{if(!!s.name.trim())try{const e=await B(y(m,"groups"),{name:s.name.trim(),description:s.description.trim(),createdAt:new Date().toISOString()});g([...p,{id:e.id,name:s.name.trim(),description:s.description.trim()}]),o(null),u({name:"",description:""})}catch(e){console.error("Error creating group:",e)}},T=async()=>{if(!(!s.name.trim()||!n))try{await G(v(m,"groups",n.id),{name:s.name.trim(),description:s.description.trim()}),g(p.map(e=>e.id===n.id?{...e,name:s.name.trim(),description:s.description.trim()}:e)),o(null),h(null),u({name:"",description:""})}catch(e){console.error("Error updating group:",e)}},A=async()=>{if(!!n)try{const e=C(n.id);await Promise.all(e.map(l=>G(v(m,"users",l.id),{groupId:null}))),await R(v(m,"groups",n.id)),g(p.filter(l=>l.id!==n.id)),N(b.map(l=>l.groupId===n.id?{...l,groupId:null}:l)),o(null),h(null)}catch(e){console.error("Error deleting group:",e)}},$=p.filter(e=>{var l;return(l=e.name)==null?void 0:l.toLowerCase().includes(x.toLowerCase())});return D?t("div",{className:"flex items-center justify-center h-64",children:t("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-brand border-t-transparent"})}):a("div",{className:"space-y-6",children:[a("div",{className:"flex justify-between items-center",children:[a("div",{children:[t("h1",{className:`text-2xl font-bold ${r?"text-leet-text":"text-gray-900"}`,children:"Groups"}),a("p",{className:r?"text-leet-sub":"text-gray-500",children:[p.length," groups total"]})]}),a("button",{onClick:()=>{o("create"),u({name:"",description:""})},className:"flex items-center gap-2 px-4 py-2 bg-brand hover:bg-brand-hover text-white rounded-lg font-medium transition-colors",children:[t(L,{})," Create Group"]})]}),t("div",{className:`rounded-lg p-4 ${r?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:a("div",{className:"relative max-w-md",children:[t(M,{className:`absolute left-3 top-1/2 -translate-y-1/2 ${r?"text-leet-sub":"text-gray-400"}`}),t("input",{type:"text",placeholder:"Search groups...",value:x,onChange:e=>E(e.target.value),className:`w-full pl-10 pr-4 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand/20 ${r?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`})]})}),a("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[$.map(e=>{const l=w(e.id),c=C(e.id).slice(0,3);return a("div",{className:`rounded-lg p-6 transition-shadow hover:shadow-lg ${r?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:[a("div",{className:"flex justify-between items-start mb-4",children:[a("div",{children:[t("h3",{className:`text-lg font-bold ${r?"text-leet-text":"text-gray-900"}`,children:e.name}),e.description&&t("p",{className:`text-sm mt-1 ${r?"text-leet-sub":"text-gray-500"}`,children:e.description})]}),a("div",{className:"flex gap-1",children:[t("button",{onClick:()=>{h(e),u({name:e.name,description:e.description||""}),o("edit")},className:`p-2 rounded-lg transition-colors ${r?"hover:bg-leet-input text-leet-sub":"hover:bg-gray-100 text-gray-500"}`,children:t(O,{})}),t("button",{onClick:()=>{h(e),o("delete")},className:`p-2 rounded-lg transition-colors text-red-500 ${r?"hover:bg-leet-input":"hover:bg-gray-100"}`,children:t(U,{})})]})]}),a("div",{className:`flex items-center gap-2 mb-4 ${r?"text-leet-sub":"text-gray-500"}`,children:[t(_,{}),a("span",{className:"font-medium",children:[l," students"]})]}),l>0&&a("div",{className:"flex items-center",children:[t("div",{className:"flex -space-x-2",children:c.map(f=>t("div",{className:"w-8 h-8 rounded-full bg-brand/20 flex items-center justify-center text-brand text-xs font-bold border-2 border-white dark:border-leet-card",title:f.email,children:(f.email||"U")[0].toUpperCase()},f.id))}),l>3&&a("span",{className:`ml-2 text-sm ${r?"text-leet-sub":"text-gray-500"}`,children:["+",l-3," more"]})]})]},e.id)}),$.length===0&&t("div",{className:`col-span-full text-center py-12 ${r?"text-leet-sub":"text-gray-500"}`,children:x?"No groups found matching your search.":"No groups yet. Create your first group!"})]}),d&&t("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>o(null),children:a("div",{className:`rounded-lg p-6 w-full max-w-md relative ${r?"bg-leet-card":"bg-white"}`,onClick:e=>e.stopPropagation(),children:[(d==="create"||d==="edit")&&a(S,{children:[t("h3",{className:`text-lg font-bold mb-4 ${r?"text-leet-text":"text-gray-900"}`,children:d==="create"?"Create New Group":"Edit Group"}),a("div",{className:"space-y-4",children:[a("div",{children:[t("label",{className:`block text-sm font-medium mb-1 ${r?"text-leet-sub":"text-gray-700"}`,children:"Group Name *"}),t("input",{type:"text",value:s.name,onChange:e=>u({...s,name:e.target.value}),placeholder:"e.g., OSAD 46",className:`w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/20 ${r?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`})]}),a("div",{children:[t("label",{className:`block text-sm font-medium mb-1 ${r?"text-leet-sub":"text-gray-700"}`,children:"Description (optional)"}),t("textarea",{value:s.description,onChange:e=>u({...s,description:e.target.value}),placeholder:"Brief description of this group...",rows:3,className:`w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/20 ${r?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`})]})]}),a("div",{className:"flex gap-3 mt-6",children:[t("button",{onClick:()=>o(null),className:`flex-1 px-4 py-2 rounded-lg ${r?"bg-leet-input hover:bg-leet-border text-leet-text":"bg-gray-100 hover:bg-gray-200"}`,children:"Cancel"}),t("button",{onClick:d==="create"?I:T,disabled:!s.name.trim(),className:"flex-1 px-4 py-2 rounded-lg bg-brand hover:bg-brand-hover text-white disabled:opacity-50",children:d==="create"?"Create":"Save"})]})]}),d==="delete"&&n&&a(S,{children:[t("h3",{className:`text-lg font-bold mb-4 ${r?"text-leet-text":"text-gray-900"}`,children:"Delete Group?"}),a("p",{className:`mb-2 ${r?"text-leet-sub":"text-gray-600"}`,children:["Are you sure you want to delete ",t("strong",{children:n.name}),"?"]}),a("p",{className:`text-sm mb-6 ${r?"text-yellow-400":"text-yellow-600"}`,children:["\u26A0\uFE0F ",w(n.id)," students will be removed from this group."]}),a("div",{className:"flex gap-3",children:[t("button",{onClick:()=>o(null),className:`flex-1 px-4 py-2 rounded-lg ${r?"bg-leet-input hover:bg-leet-border text-leet-text":"bg-gray-100 hover:bg-gray-200"}`,children:"Cancel"}),t("button",{onClick:A,className:"flex-1 px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white",children:"Delete"})]})]}),t("button",{onClick:()=>o(null),className:`absolute top-4 right-4 p-2 rounded-lg ${r?"hover:bg-leet-input text-leet-sub":"hover:bg-gray-100 text-gray-500"}`,children:t(z,{})})]})})]})};export{Q as default};
