import{l as V,r as d,j as t,d as a,F as D}from"./vendor-react.06bced68.js";import{h as p,M as G,K as X,N as Y,f as Z,P as ee,ah as te,s as re,ai as le,a as P}from"./index.17f04fdd.js";import{l as S,_ as f,v as ae,r as se,a as F,y as ne}from"./vendor-firebase.bbe5d1cc.js";import{P as oe}from"./ProblemSetBuilder.43f182f2.js";import"./vendor-ui.c6987468.js";const me=()=>{const{isDark:s,adminUser:y}=V()||{isDark:!0,adminUser:null},[b,x]=d.exports.useState([]),[A,E]=d.exports.useState([]),[C,T]=d.exports.useState([]),[j,M]=d.exports.useState(!0),[g,h]=d.exports.useState(null),[c,v]=d.exports.useState(null),[N,O]=d.exports.useState("all"),[B,w]=d.exports.useState(!1),[r,i]=d.exports.useState({title:"",description:"",targetGroup:"All",deadline:"",problems:[""]});d.exports.useEffect(()=>{I()},[]);const I=async()=>{try{const[e,l,n]=await Promise.all([S(f(p,"assignments")),S(f(p,"groups")),S(f(p,"users"))]);x(e.docs.map(o=>({id:o.id,...o.data()}))),E(l.docs.map(o=>({id:o.id,...o.data()}))),T(n.docs.map(o=>({id:o.id,...o.data()})))}catch(e){console.error("Error fetching assignments:",e)}finally{M(!1)}},$=e=>{const l=new Date,n=new Date(e.deadline);return l>n?"past":"active"},_=e=>{const l={active:s?"bg-green-900/50 text-green-300":"bg-green-100 text-green-700",past:s?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"},n={active:"Active",past:"Past Due"};return{style:l[e],label:n[e]}},z=e=>{if(e==="All")return"All Groups";const l=A.find(n=>n.id===e);return(l==null?void 0:l.name)||e},L=e=>e==="All"?C.length:C.filter(l=>l.groupId===e).length,k=b.filter(e=>N==="all"||$(e)===N).sort((e,l)=>new Date(l.createdAt)-new Date(e.createdAt)),U=async()=>{if(!(!r.title.trim()||!r.deadline))try{const e=await ae(f(p,"assignments"),{title:r.title.trim(),description:r.description.trim(),creatorId:(y==null?void 0:y.email)||"admin",targetGroup:r.targetGroup,problems:r.problems.filter(l=>l.trim()),deadline:new Date(r.deadline).toISOString(),createdAt:new Date().toISOString()});x([{id:e.id,...r,createdAt:new Date().toISOString()},...b]),u()}catch(e){console.error("Error creating assignment:",e)}},K=async()=>{if(!(!r.title.trim()||!c))try{await se(F(p,"assignments",c.id),{title:r.title.trim(),description:r.description.trim(),targetGroup:r.targetGroup,problems:r.problems.filter(e=>e.trim()),deadline:new Date(r.deadline).toISOString()}),x(b.map(e=>e.id===c.id?{...e,...r}:e)),u()}catch(e){console.error("Error updating assignment:",e)}},R=async()=>{if(!!c)try{await ne(F(p,"assignments",c.id)),x(b.filter(e=>e.id!==c.id)),u()}catch(e){console.error("Error deleting assignment:",e)}},u=()=>{h(null),v(null),i({title:"",description:"",targetGroup:"All",deadline:"",problems:[""]})},W=e=>{var l;v(e),i({title:e.title,description:e.description||"",targetGroup:e.targetGroup||"All",deadline:e.deadline?new Date(e.deadline).toISOString().slice(0,16):"",problems:(l=e.problems)!=null&&l.length?e.problems:[""]}),h("edit")},q=()=>i({...r,problems:[...r.problems,""]}),H=e=>i({...r,problems:r.problems.filter((l,n)=>n!==e)}),J=(e,l)=>{const n=[...r.problems];n[e]=l,i({...r,problems:n})},Q=e=>{const l=new Date,n=new Date(e),o=Math.ceil((n-l)/(1e3*60*60*24));return o<0?`${Math.abs(o)} days ago`:o===0?"Today":o===1?"Tomorrow":`${o} days left`};return j?t("div",{className:"flex items-center justify-center h-64",children:t("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-brand border-t-transparent"})}):a("div",{className:"space-y-6",children:[a("div",{className:"flex justify-between items-center",children:[a("div",{children:[t("h1",{className:`text-2xl font-bold ${s?"text-leet-text":"text-gray-900"}`,children:"Assignments"}),a("p",{className:s?"text-leet-sub":"text-gray-500",children:[b.length," assignments total"]})]}),a("button",{onClick:()=>{h("create"),i({title:"",description:"",targetGroup:"All",deadline:"",problems:[""]})},className:"flex items-center gap-2 px-4 py-2 bg-brand hover:bg-brand-hover text-white rounded-lg font-medium transition-colors",children:[t(G,{})," Create Assignment"]})]}),t("div",{className:`rounded-lg p-4 flex gap-2 ${s?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:["all","active","past"].map(e=>t("button",{onClick:()=>O(e),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors capitalize ${N===e?"bg-brand text-white":s?"bg-leet-input text-leet-text hover:bg-leet-border":"bg-gray-100 hover:bg-gray-200"}`,children:e==="all"?"All":e==="past"?"Past Due":"Active"},e))}),a("div",{className:"space-y-4",children:[k.map(e=>{var m;const l=$(e),n=_(l),o=Q(e.deadline);return t("div",{className:`rounded-lg p-6 transition-shadow hover:shadow-lg ${s?"bg-leet-card border border-leet-border":"bg-white shadow"}`,children:a("div",{className:"flex justify-between items-start",children:[a("div",{className:"flex-1",children:[a("div",{className:"flex items-center gap-3 mb-2",children:[t(X,{className:l==="active"?"text-blue-500":s?"text-leet-sub":"text-gray-400"}),t("h3",{className:`text-lg font-bold ${s?"text-leet-text":"text-gray-900"}`,children:e.title}),t("span",{className:`px-2 py-1 rounded text-xs font-medium ${n.style}`,children:n.label})]}),e.description&&t("p",{className:`text-sm mb-3 ${s?"text-leet-sub":"text-gray-600"}`,children:e.description}),a("div",{className:`flex flex-wrap gap-4 text-sm ${s?"text-leet-sub":"text-gray-500"}`,children:[a("span",{className:"flex items-center gap-1",children:[t(Y,{})," ",z(e.targetGroup)," (",L(e.targetGroup)," students)"]}),a("span",{className:`flex items-center gap-1 ${l==="past"?"text-red-400":""}`,children:[l==="past"?t(Z,{}):t(ee,{}),o]}),a("span",{children:[((m=e.problems)==null?void 0:m.length)||0," problems"]})]})]}),a("div",{className:"flex gap-2",children:[t("button",{onClick:()=>W(e),className:`p-2 rounded-lg transition-colors ${s?"hover:bg-leet-input text-leet-sub":"hover:bg-gray-100 text-gray-500"}`,title:"Edit",children:t(te,{})}),t("button",{onClick:()=>{v(e),h("delete")},className:`p-2 rounded-lg transition-colors text-red-500 ${s?"hover:bg-leet-input":"hover:bg-gray-100"}`,title:"Delete",children:t(re,{})})]})]})},e.id)}),k.length===0&&t("div",{className:`text-center py-12 ${s?"text-leet-sub":"text-gray-500"}`,children:"No assignments found. Create your first assignment!"})]}),g&&t("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 overflow-y-auto",onClick:u,children:a("div",{className:`rounded-lg p-6 w-full max-w-2xl my-8 relative max-h-[90vh] overflow-y-auto ${s?"bg-leet-card":"bg-white"}`,onClick:e=>e.stopPropagation(),children:[(g==="create"||g==="edit")&&a(D,{children:[t("h3",{className:`text-lg font-bold mb-6 ${s?"text-leet-text":"text-gray-900"}`,children:g==="create"?"Create New Assignment":"Edit Assignment"}),a("div",{className:"space-y-4",children:[a("div",{children:[t("label",{className:`block text-sm font-medium mb-1 ${s?"text-leet-sub":"text-gray-700"}`,children:"Assignment Title *"}),t("input",{type:"text",value:r.title,onChange:e=>i({...r,title:e.target.value}),placeholder:"e.g., Week 3 - Arrays & Strings",className:`w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/20 ${s?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`})]}),a("div",{children:[t("label",{className:`block text-sm font-medium mb-1 ${s?"text-leet-sub":"text-gray-700"}`,children:"Description"}),t("textarea",{value:r.description,onChange:e=>i({...r,description:e.target.value}),placeholder:"Brief description or instructions...",rows:2,className:`w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/20 ${s?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`})]}),a("div",{className:"grid grid-cols-2 gap-4",children:[a("div",{children:[t("label",{className:`block text-sm font-medium mb-1 ${s?"text-leet-sub":"text-gray-700"}`,children:"Target Group"}),a("select",{value:r.targetGroup,onChange:e=>i({...r,targetGroup:e.target.value}),className:`w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/20 ${s?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`,children:[t("option",{value:"All",children:"All Groups"}),A.map(e=>t("option",{value:e.id,children:e.name},e.id))]})]}),a("div",{children:[t("label",{className:`block text-sm font-medium mb-1 ${s?"text-leet-sub":"text-gray-700"}`,children:"Deadline *"}),t("input",{type:"datetime-local",value:r.deadline,onChange:e=>i({...r,deadline:e.target.value}),className:`w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/20 ${s?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`})]})]}),a("div",{children:[a("div",{className:"flex justify-between items-center mb-2",children:[a("label",{className:`block text-sm font-medium ${s?"text-leet-sub":"text-gray-700"}`,children:["Problems (",r.problems.filter(e=>e.trim()).length," added)"]}),a("button",{type:"button",onClick:()=>w(!0),className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all",children:[t(le,{})," Smart Add"]})]}),t("div",{className:"space-y-2",children:r.problems.map((e,l)=>a("div",{className:"flex gap-2",children:[t("input",{type:"text",value:e,onChange:n=>J(l,n.target.value),placeholder:"e.g., two-sum",className:`flex-1 px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand/20 ${s?"bg-leet-input text-leet-text border border-leet-border":"bg-gray-100"}`}),r.problems.length>1&&t("button",{onClick:()=>H(l),className:"p-2 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-lg",children:t(P,{})})]},l))}),a("button",{onClick:q,className:"mt-2 text-sm flex items-center gap-1 text-brand hover:underline",children:[t(G,{})," Add Problem Manually"]})]})]}),a("div",{className:"flex gap-3 mt-6",children:[t("button",{onClick:u,className:`flex-1 px-4 py-2 rounded-lg ${s?"bg-leet-input hover:bg-leet-border text-leet-text":"bg-gray-100 hover:bg-gray-200"}`,children:"Cancel"}),t("button",{onClick:g==="create"?U:K,disabled:!r.title.trim()||!r.deadline,className:"flex-1 px-4 py-2 rounded-lg bg-brand hover:bg-brand-hover text-white disabled:opacity-50",children:g==="create"?"Create Assignment":"Save Changes"})]})]}),g==="delete"&&c&&a(D,{children:[t("h3",{className:`text-lg font-bold mb-4 ${s?"text-leet-text":"text-gray-900"}`,children:"Delete Assignment?"}),a("p",{className:`mb-6 ${s?"text-leet-sub":"text-gray-600"}`,children:["Are you sure you want to delete ",t("strong",{children:c.title}),"? This action cannot be undone."]}),a("div",{className:"flex gap-3",children:[t("button",{onClick:u,className:`flex-1 px-4 py-2 rounded-lg ${s?"bg-leet-input hover:bg-leet-border text-leet-text":"bg-gray-100 hover:bg-gray-200"}`,children:"Cancel"}),t("button",{onClick:R,className:"flex-1 px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white",children:"Delete"})]})]}),t("button",{onClick:u,className:`absolute top-4 right-4 p-2 rounded-lg ${s?"hover:bg-leet-input text-leet-sub":"hover:bg-gray-100 text-gray-500"}`,children:t(P,{})})]})}),t(oe,{isOpen:B,onClose:()=>w(!1),onConfirm:e=>{const l=e.map(m=>m.titleSlug),n=r.problems.filter(m=>m.trim()),o=[...new Set([...n,...l])];i({...r,problems:o.length>0?o:[""]}),w(!1)}})]})};export{me as default};
