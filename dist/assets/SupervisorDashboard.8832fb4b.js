import{r as c,_ as O,b as a,j as e,F as T}from"./vendor-react.4d235dc1.js";import{z as $,u as H,A as G,B as q,C as z,y as B,D as V,c as K}from"./index.3e0ca8a6.js";import{R as I,h as M,j as W,f as Y}from"./vendor-firebase.278f80a4.js";import{E as J}from"./vendor-utils.bc6193ac.js";import{S as h}from"./Skeleton.58371651.js";const L="https://alfa-leetcode-api.onrender.com";async function Q(r,s,n){let i=[];for(let d=0;d<r.length;d+=s){const p=r.slice(d,d+s),l=await Promise.all(p.map(n));i=[...i,...l],d+s<r.length&&await new Promise(u=>setTimeout(u,1e3))}return i}const X={async fetchGroupStats(r){try{let s=I(M($,"users"));r!=="All"&&(s=I(M($,"users"),W("groupId","==",r)));const d=(await Y(s)).docs.map(l=>({id:l.id,...l.data()})).filter(l=>l.leetcodeUsername);return await Q(d,5,async l=>{var u,f,y,x,v,g,t,o,S,m,w,k,_,A,E,R,j,P,C,F,D,U;try{const N=await fetch(`${L}/user/${l.leetcodeUsername}/skill-stats`);if(!N.ok)throw new Error("Failed");const b=await N.json();return{...l,skillStats:((f=(u=b.data)==null?void 0:u.matchedUser)==null?void 0:f.tagProblemCounts)||{},totalSolved:((t=(g=(v=(x=(y=b.data)==null?void 0:y.matchedUser)==null?void 0:x.submitStats)==null?void 0:v.acSubmissionNum)==null?void 0:g[0])==null?void 0:t.count)||0,easySolved:((k=(w=(m=(S=(o=b.data)==null?void 0:o.matchedUser)==null?void 0:S.submitStats)==null?void 0:m.acSubmissionNum)==null?void 0:w[1])==null?void 0:k.count)||0,mediumSolved:((j=(R=(E=(A=(_=b.data)==null?void 0:_.matchedUser)==null?void 0:A.submitStats)==null?void 0:E.acSubmissionNum)==null?void 0:R[2])==null?void 0:j.count)||0,hardSolved:((U=(D=(F=(C=(P=b.data)==null?void 0:P.matchedUser)==null?void 0:C.submitStats)==null?void 0:F.acSubmissionNum)==null?void 0:D[3])==null?void 0:U.count)||0}}catch(N){return console.warn(`Failed to fetch stats for ${l.leetcodeUsername}`,N),{...l,error:!0}}})}catch(s){throw console.error("Error fetching group stats:",s),s}},async fetchStudentDetails(r){try{return(await(await fetch(`${L}/user/${r}/ac-submission-records`)).json()).submission||[]}catch(s){return console.error("Error fetching student details:",s),[]}},generateWeaknessReport(r){if(!r.skillStats)return"No data available.";const s=r.totalSolved||0;if(s<10)return"Student is just starting. Encourage solving more Easy problems.";const n=r.easySolved||0,i=r.mediumSolved||0,d=r.hardSolved||0;return n/s>.7?"Student solves mostly Easy problems. Recommendation: Assign more Medium problems to build depth.":d===0&&i>20?"Student is comfortable with Mediums. Recommendation: Challenge them with a Hard problem.":"Student has a balanced profile. Keep up the good work!"}},Z=c.exports.lazy(()=>O(()=>import("./SkillRadarChart.249fa21f.js"),["assets/SkillRadarChart.249fa21f.js","assets/vendor-react.4d235dc1.js","assets/vendor-charts.6f5577fc.js"])),ee=c.exports.lazy(()=>O(()=>import("./StudentInsightsModal.fcdbdc86.js"),["assets/StudentInsightsModal.fcdbdc86.js","assets/vendor-react.4d235dc1.js","assets/index.3e0ca8a6.js","assets/index.d46d90bc.css","assets/vendor-firebase.278f80a4.js","assets/vendor-ui.7a96cdac.js","assets/vendor-charts.6f5577fc.js","assets/vendor-utils.bc6193ac.js","assets/Skeleton.58371651.js"])),te=()=>{const{userData:r,isAdmin:s}=H(),[n,i]=c.exports.useState([]),[d,p]=c.exports.useState(!0),[l,u]=c.exports.useState(null),[f,y]=c.exports.useState(null),x=async()=>{p(!0);try{const t=s?"All":r.groupId||"NoGroup",o=await X.fetchGroupStats(t);i(o),y([12,15,10,5,8,6])}catch(t){console.error(t),alert("Failed to load analytics.")}finally{p(!1)}};c.exports.useEffect(()=>{r&&x()},[r]);const v=()=>{const t=new J;t.text(`Group Performance Report - ${new Date().toLocaleDateString()}`,14,15);const o=["Student","Total Solved","Easy","Medium","Hard","Last Active"],S=n.map(m=>[m.username,m.totalSolved,m.easySolved,m.mediumSolved,m.hardSolved,"N/A"]);t.autoTable({head:[o],body:S,startY:20}),t.save("group_report.pdf")},g=n.reduce((t,o)=>t.totalSolved>o.totalSolved?t:o,{});return a("div",{className:"max-w-7xl mx-auto p-6",children:[a("div",{className:"flex justify-between items-center mb-8",children:[a("h1",{className:"text-3xl font-bold flex items-center gap-2 dark:text-white",children:[e(G,{className:"text-brand"})," Supervisor Dashboard"]}),a("div",{className:"flex gap-2",children:[a("button",{onClick:x,className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded flex items-center gap-2",children:[e(q,{})," Refresh"]}),a("button",{onClick:v,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded flex items-center gap-2",children:[e(z,{})," Export Report"]})]})]}),e("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:d?a(T,{children:[e(h,{variant:"rect",className:"h-32"}),e(h,{variant:"rect",className:"h-32"}),e(h,{variant:"rect",className:"h-32"})]}):a(T,{children:[e("div",{className:"bg-white dark:bg-leet-card p-6 rounded-lg shadow border-l-4 border-blue-500",children:a("div",{className:"flex justify-between items-center",children:[a("div",{children:[e("p",{className:"text-sm text-gray-500 dark:text-gray-400 uppercase font-bold",children:"Total Solved"}),e("p",{className:"text-3xl font-bold dark:text-white",children:n.reduce((t,o)=>t+(o.totalSolved||0),0)})]}),e(G,{className:"text-4xl text-blue-200"})]})}),e("div",{className:"bg-white dark:bg-leet-card p-6 rounded-lg shadow border-l-4 border-purple-500",children:a("div",{className:"flex justify-between items-center",children:[a("div",{children:[e("p",{className:"text-sm text-gray-500 dark:text-gray-400 uppercase font-bold",children:"Active Students"}),e("p",{className:"text-3xl font-bold dark:text-white",children:n.length})]}),e(B,{className:"text-4xl text-purple-200"})]})}),e("div",{className:"bg-white dark:bg-leet-card p-6 rounded-lg shadow border-l-4 border-yellow-500",children:a("div",{className:"flex justify-between items-center",children:[a("div",{children:[e("p",{className:"text-sm text-gray-500 dark:text-gray-400 uppercase font-bold",children:"Top Performer"}),e("p",{className:"text-xl font-bold dark:text-white truncate max-w-[150px]",children:g.username||"N/A"}),a("p",{className:"text-xs text-gray-500",children:[g.totalSolved||0," Solved"]})]}),e(V,{className:"text-4xl text-yellow-200"})]})})]})}),a("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a("div",{className:"lg:col-span-2 bg-white dark:bg-leet-card rounded-lg shadow overflow-hidden",children:[e("div",{className:"px-6 py-4 border-b dark:border-leet-border",children:e("h3",{className:"font-bold text-lg dark:text-white",children:"Student Performance"})}),e("div",{className:"overflow-x-auto",children:a("table",{className:"min-w-full text-sm",children:[e("thead",{className:"bg-gray-50 dark:bg-leet-input",children:a("tr",{children:[e("th",{className:"px-6 py-3 text-left dark:text-gray-300",children:"Student"}),e("th",{className:"px-6 py-3 text-right dark:text-gray-300",children:"Total"}),e("th",{className:"px-6 py-3 text-right text-green-600",children:"Easy"}),e("th",{className:"px-6 py-3 text-right text-yellow-600",children:"Med"}),e("th",{className:"px-6 py-3 text-right text-red-600",children:"Hard"})]})}),e("tbody",{className:"divide-y divide-gray-200 dark:divide-leet-border",children:d?[...Array(5)].map((t,o)=>a("tr",{children:[e("td",{className:"px-6 py-4",children:e(h,{variant:"text",className:"h-4 w-24"})}),e("td",{className:"px-6 py-4",children:e(h,{variant:"text",className:"h-4 w-8 ml-auto"})}),e("td",{className:"px-6 py-4",children:e(h,{variant:"text",className:"h-4 w-8 ml-auto"})}),e("td",{className:"px-6 py-4",children:e(h,{variant:"text",className:"h-4 w-8 ml-auto"})}),e("td",{className:"px-6 py-4",children:e(h,{variant:"text",className:"h-4 w-8 ml-auto"})})]},o)):n.map((t,o)=>a("tr",{onClick:()=>u(t),className:"hover:bg-gray-50 dark:hover:bg-leet-input cursor-pointer transition",children:[e("td",{className:"px-6 py-4 font-medium dark:text-white",children:t.username}),e("td",{className:"px-6 py-4 text-right font-bold dark:text-white",children:t.totalSolved}),e("td",{className:"px-6 py-4 text-right dark:text-gray-400",children:t.easySolved}),e("td",{className:"px-6 py-4 text-right dark:text-gray-400",children:t.mediumSolved}),e("td",{className:"px-6 py-4 text-right dark:text-gray-400",children:t.hardSolved})]},o))})]})})]}),a("div",{className:"bg-white dark:bg-leet-card rounded-lg shadow p-6 flex flex-col items-center",children:[e("h3",{className:"font-bold text-lg mb-4 dark:text-white w-full text-left",children:"Skill Radar"}),e("div",{className:"w-full max-w-xs min-h-[300px] flex items-center justify-center",children:e(c.exports.Suspense,{fallback:e(K,{className:"animate-spin text-4xl text-brand"}),children:e(Z,{studentStats:l,groupAverage:f})})}),e("p",{className:"text-xs text-gray-500 mt-4 text-center",children:l?`Comparing ${l.username} vs Group Average`:"Select a student to compare"})]})]}),e(c.exports.Suspense,{fallback:null,children:e(ee,{isOpen:!!l,onClose:()=>u(null),student:l})})]})};var de=Object.freeze(Object.defineProperty({__proto__:null,default:te},Symbol.toStringTag,{value:"Module"}));export{de as S,X as a};
