import{r as c,b as n,j as t,g as C,_ as P}from"./vendor-react.4d235dc1.js";import{v as x,m as S,k as L,u as _,A as j,h as A,f as R,x as $}from"./index.e1876ed1.js";import{R as T,h as k,I as F,b as E,a as D,j as M,f as U,p as V}from"./vendor-firebase.278f80a4.js";import{B as z}from"./Badge.5da61a7e.js";import"./vendor-ui.7a96cdac.js";const B=({contestId:i})=>{const[m,u]=c.exports.useState([]);c.exports.useEffect(()=>{if(!i)return;const s=T(k(x,"contests",i,"submissions"));return F(s,async y=>{const v=y.docs.map(e=>e.data()),d={},p=new Set;v.forEach(e=>{if(p.add(e.userId),d[e.userId]||(d[e.userId]={userId:e.userId,username:e.username,totalScore:0,problemsSolved:new Set,lastSubmissionTime:0}),!d[e.userId].problemsSolved.has(e.problemSlug)){d[e.userId].problemsSolved.add(e.problemSlug),d[e.userId].totalScore+=e.score;const a=new Date(e.timestamp).getTime();a>d[e.userId].lastSubmissionTime&&(d[e.userId].lastSubmissionTime=a)}});const w={};await Promise.all(Array.from(p).map(async e=>{const a=await E(D(x,"users",e));a.exists()&&(w[e]=a.data().badges||[])}));const o=Object.values(d).sort((e,a)=>a.totalScore!==e.totalScore?a.totalScore-e.totalScore:e.lastSubmissionTime-a.lastSubmissionTime).map(e=>({...e,badges:w[e.userId]||[]}));u(o)})},[i]);const l=s=>s===0?"bg-yellow-100 dark:bg-yellow-900/30 border-l-4 border-yellow-400":s===1?"bg-gray-100 dark:bg-gray-800/50 border-l-4 border-gray-400":s===2?"bg-orange-100 dark:bg-orange-900/30 border-l-4 border-orange-400":"hover:bg-gray-50 dark:hover:bg-leet-input border-l-4 border-transparent",N=s=>s===0?t(L,{className:"text-yellow-500 text-xl"}):s===1?t(S,{className:"text-gray-400 text-lg"}):s===2?t(S,{className:"text-orange-500 text-lg"}):n("span",{className:"font-mono font-bold text-gray-500 dark:text-gray-400",children:["#",s+1]});return n("div",{className:"bg-white dark:bg-leet-card rounded-lg shadow overflow-hidden",children:[t("div",{className:"bg-brand px-4 py-3 border-b border-brand-dark",children:n("h3",{className:"text-white font-bold flex items-center gap-2",children:[t(S,{})," Live Leaderboard"]})}),t("div",{className:"overflow-x-auto",children:n("table",{className:"min-w-full text-sm",children:[t("thead",{className:"bg-gray-50 dark:bg-leet-input",children:n("tr",{children:[t("th",{className:"px-4 py-2 text-left dark:text-gray-300 w-16",children:"Rank"}),t("th",{className:"px-4 py-2 text-left dark:text-gray-300",children:"User"}),t("th",{className:"px-4 py-2 text-right dark:text-gray-300",children:"Solved"}),t("th",{className:"px-4 py-2 text-right dark:text-gray-300",children:"Score"})]})}),n("tbody",{className:"divide-y divide-gray-200 dark:divide-leet-border",children:[m.map((s,g)=>n("tr",{className:`transition duration-150 ${l(g)}`,children:[t("td",{className:"px-4 py-3 flex items-center justify-center",children:N(g)}),t("td",{className:"px-4 py-3",children:n("div",{className:"flex items-center gap-2",children:[t("span",{className:"font-bold dark:text-white",children:s.username}),s.badges.length>0&&t("div",{className:"scale-75 origin-left",children:t(z,{name:s.badges[s.badges.length-1],size:"sm"})})]})}),t("td",{className:"px-4 py-3 text-right dark:text-gray-400 font-mono",children:s.problemsSolved.size}),t("td",{className:"px-4 py-3 text-right font-bold text-brand dark:text-brand-dark text-lg",children:s.totalScore})]},s.userId)),m.length===0&&t("tr",{children:t("td",{colSpan:"4",className:"text-center py-4 text-gray-500",children:"No submissions yet."})})]})]})})]})},J=()=>{const{contestId:i}=C(),{userData:m,currentUser:u}=_(),[l,N]=c.exports.useState(null),[s,g]=c.exports.useState(""),[y,v]=c.exports.useState(null),[d,p]=c.exports.useState(new Set);c.exports.useEffect(()=>{(async()=>{const o=D(x,"contests",i),e=await E(o);e.exists()&&N({id:e.id,...e.data()})})()},[i]),c.exports.useEffect(()=>{(async()=>{if(!u)return;const o=T(k(x,"contests",i,"submissions"),M("userId","==",u.uid)),e=await U(o),a=new Set(e.docs.map(b=>b.data().problemSlug));p(a)})()},[i,u]),c.exports.useEffect(()=>{if(!l)return;const r=setInterval(()=>{const o=new Date().getTime(),a=new Date(l.endTime).getTime()-o;if(a<0)g("ENDED"),clearInterval(r);else{const b=Math.floor(a%864e5/36e5),I=Math.floor(a%(1e3*60*60)/(1e3*60)),h=Math.floor(a%(1e3*60)/1e3);g(`${b}h ${I}m ${h}s`)}},1e3);return()=>clearInterval(r)},[l]);const w=async r=>{var o;if(!m.leetcodeUsername)return alert("Please set your LeetCode username in Profile first!");v(r.slug);try{const a=await(await fetch(`https://alfa-leetcode-api.onrender.com/user/${m.leetcodeUsername}/ac-submission-records`)).json(),b=new Date(l.startTime).getTime();if((o=a.submission)==null?void 0:o.find(h=>{const f=parseInt(h.timestamp)*1e3;return h.titleSlug===r.slug&&f>b})){await V(k(x,"contests",i,"submissions"),{userId:u.uid,username:m.leetcodeUsername,problemSlug:r.slug,score:r.score,timestamp:new Date().toISOString()}),p(f=>new Set(f).add(r.slug));const h=(await P(()=>import("./vendor-utils.bc6193ac.js").then(function(f){return f.c}),["assets/vendor-utils.bc6193ac.js","assets/vendor-react.4d235dc1.js"])).default;h({particleCount:100,spread:70,origin:{y:.6}}),alert(`Correct! +${r.score} points`)}else alert("No valid submission found after contest start time. Make sure you solved it on LeetCode recently.")}catch(e){console.error(e),alert("Verification failed. API might be down.")}finally{v(null)}};return l?n("div",{className:"max-w-6xl mx-auto p-4 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[n("div",{className:"lg:col-span-2 space-y-6",children:[t("div",{className:"bg-white dark:bg-leet-card rounded-lg shadow p-6 border-l-4 border-brand",children:n("div",{className:"flex justify-between items-center",children:[t("h1",{className:"text-2xl font-bold dark:text-white",children:l.title}),n("div",{className:"text-xl font-mono font-bold bg-gray-100 dark:bg-leet-input px-4 py-2 rounded flex items-center gap-2 dark:text-white",children:[t(j,{className:s==="ENDED"?"text-red-500":"text-green-500"}),s]})]})}),t("div",{className:"bg-white dark:bg-leet-card rounded-lg shadow overflow-hidden",children:n("table",{className:"min-w-full",children:[t("thead",{className:"bg-gray-50 dark:bg-leet-input",children:n("tr",{children:[t("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Problem"}),t("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Points"}),t("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Action"})]})}),t("tbody",{className:"divide-y divide-gray-200 dark:divide-leet-border",children:l.problems.map((r,o)=>{const e=d.has(r.slug);return n("tr",{className:e?"bg-green-50 dark:bg-green-900/20":"",children:[t("td",{className:"px-6 py-4 whitespace-nowrap",children:n("a",{href:`https://leetcode.com/problems/${r.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-brand dark:text-brand-dark font-medium hover:underline flex items-center gap-1",children:[r.slug," ",t(A,{size:12})]})}),t("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold dark:text-white",children:r.score}),t("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e?n("span",{className:"text-green-600 font-bold flex items-center justify-end gap-1",children:[t(R,{})," Solved"]}):t("button",{onClick:()=>w(r),disabled:y===r.slug||s==="ENDED",className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm flex items-center gap-1 ml-auto disabled:opacity-50",children:y===r.slug?t($,{className:"animate-spin"}):"Verify"})})]},o)})})]})})]}),t("div",{className:"lg:col-span-1",children:t(B,{contestId:l.id})})]}):t("div",{className:"p-6",children:"Loading Arena..."})};export{J as default};
